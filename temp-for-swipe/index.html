<!DOCTYPE html>

<html>
	<head>
		<style>
			:root {
				color-scheme: only dark;
			}
			
			* {
				margin: 0;
				padding: 0;
			}
			
			#to_rotate {
				position: absolute;
				width: 20%;
				height: 70%;
				left: 40%;
				top: 15%;
				background-color: rgb(200, 100, 100);
				
				-webkit-transform-origin: 50% 100%;
				-moz-transform-origin: 50% 100%;
				-ms-transform-origin: 50% 100%;
				-o-transform-origin: 50% 100%;
				transform-origin: 50% 100%;
			}
		</style>
	</head>
	
	<body>
		<div id="to_rotate" onclick="snap_to_mouse()" onmousemove="track_mouse(event)">
		</div>
		
		<script>
			const to_rotate = document.getElementById("to_rotate");
			const to_rotate_rect = to_rotate.getBoundingClientRect();
			const rotation_origin = { x: to_rotate_rect.x + Math.round(to_rotate_rect.width / 2), y: to_rotate_rect.y + to_rotate_rect.height };
			
			const track_mouse = (event) => {
				let angle = Math.atan2(event.clientY - rotation_origin.y, event.clientX - rotation_origin.x) + Math.PI / 2;
				
				angle = angle < -Math.PI / 4 ? -Math.PI / 4 : angle;
				angle = angle > Math.PI / 4 ? Math.PI / 4 : angle;
				
				to_rotate.style.webkitTransform = `rotate(${angle}rad)`;
				to_rotate.style.mozTransform = `rotate(${angle}rad)`;
				to_rotate.style.msTransform = `rotate(${angle}rad)`;
				to_rotate.style.oTransform = `rotate(${angle}rad)`;
				to_rotate.style.transform = `rotate(${angle}rad)`;
			}
		</script>
	</body>
</html>